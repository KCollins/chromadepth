// Chromadepth Color Palette
// Maps grayscale values (0-255) to Chromadepth RGB colors
// The official ChromaDepth palette from the ACT file

const CHROMADEPTH_PALETTE = [
    // Black (far) to Red to Yellow to Green to Cyan to Blue to Magenta to White (near)
    { r: 0, g: 0, b: 0 },       // 0 - Black
    { r: 3, g: 0, b: 15 },      // 1
    { r: 6, g: 0, b: 30 },      // 2
    { r: 9, g: 0, b: 46 },      // 3
    { r: 12, g: 0, b: 61 },     // 4
    { r: 15, g: 0, b: 77 },     // 5
    { r: 18, g: 0, b: 92 },     // 6
    { r: 21, g: 0, b: 108 },    // 7
    { r: 24, g: 0, b: 123 },    // 8
    { r: 27, g: 0, b: 139 },    // 9
    { r: 30, g: 0, b: 154 },    // 10
    { r: 33, g: 0, b: 170 },    // 11
    { r: 36, g: 0, b: 185 },    // 12
    { r: 39, g: 0, b: 201 },    // 13
    { r: 42, g: 0, b: 216 },    // 14
    { r: 45, g: 0, b: 232 },    // 15
    { r: 48, g: 12, b: 235 },   // 16
    { r: 51, g: 24, b: 235 },   // 17
    { r: 54, g: 36, b: 235 },   // 18
    { r: 57, g: 48, b: 235 },   // 19
    { r: 60, g: 60, b: 235 },   // 20
    { r: 63, g: 72, b: 235 },   // 21
    { r: 66, g: 84, b: 235 },   // 22
    { r: 69, g: 96, b: 235 },   // 23
    { r: 72, g: 108, b: 235 },  // 24
    { r: 75, g: 120, b: 235 },  // 25
    { r: 78, g: 132, b: 235 },  // 26
    { r: 81, g: 144, b: 235 },  // 27
    { r: 84, g: 156, b: 235 },  // 28
    { r: 87, g: 168, b: 235 },  // 29
    { r: 90, g: 180, b: 235 },  // 30
    { r: 93, g: 192, b: 235 },  // 31
    { r: 96, g: 204, b: 235 },  // 32
    { r: 99, g: 216, b: 235 },  // 33
    { r: 102, g: 228, b: 235 }, // 34
    { r: 105, g: 235, b: 235 }, // 35
    { r: 108, g: 235, b: 223 }, // 36
    { r: 111, g: 235, b: 211 }, // 37
    { r: 114, g: 235, b: 199 }, // 38
    { r: 117, g: 235, b: 187 }, // 39
    { r: 120, g: 235, b: 175 }, // 40
    { r: 123, g: 235, b: 163 }, // 41
    { r: 126, g: 235, b: 151 }, // 42
    { r: 129, g: 235, b: 139 }, // 43
    { r: 132, g: 235, b: 127 }, // 44
    { r: 135, g: 235, b: 115 }, // 45
    { r: 138, g: 235, b: 103 }, // 46
    { r: 141, g: 235, b: 91 },  // 47
    { r: 144, g: 235, b: 79 },  // 48
    { r: 147, g: 235, b: 67 },  // 49
    { r: 150, g: 235, b: 55 },  // 50
    { r: 153, g: 235, b: 43 },  // 51
    { r: 156, g: 235, b: 31 },  // 52
    { r: 159, g: 235, b: 19 },  // 53
    { r: 162, g: 235, b: 7 },   // 54
    { r: 165, g: 235, b: 0 },   // 55
    { r: 177, g: 235, b: 0 },   // 56
    { r: 189, g: 235, b: 0 },   // 57
    { r: 201, g: 235, b: 0 },   // 58
    { r: 213, g: 235, b: 0 },   // 59
    { r: 225, g: 235, b: 0 },   // 60
    { r: 235, g: 235, b: 0 },   // 61
    { r: 235, g: 223, b: 0 },   // 62
    { r: 235, g: 211, b: 0 },   // 63
    { r: 235, g: 199, b: 0 },   // 64
    { r: 235, g: 187, b: 0 },   // 65
    { r: 235, g: 175, b: 0 },   // 66
    { r: 235, g: 163, b: 0 },   // 67
    { r: 235, g: 151, b: 0 },   // 68
    { r: 235, g: 139, b: 0 },   // 69
    { r: 235, g: 127, b: 0 },   // 70
    { r: 235, g: 115, b: 0 },   // 71
    { r: 235, g: 103, b: 0 },   // 72
    { r: 235, g: 91, b: 0 },    // 73
    { r: 235, g: 79, b: 0 },    // 74
    { r: 235, g: 67, b: 0 },    // 75
    { r: 235, g: 55, b: 0 },    // 76
    { r: 235, g: 43, b: 0 },    // 77
    { r: 235, g: 31, b: 0 },    // 78
    { r: 235, g: 19, b: 0 },    // 79
    { r: 235, g: 7, b: 0 },     // 80
    { r: 235, g: 0, b: 0 },     // 81 - Red
    { r: 235, g: 0, b: 7 },     // 82
    { r: 235, g: 0, b: 19 },    // 83
    { r: 235, g: 0, b: 31 },    // 84
    { r: 235, g: 0, b: 43 },    // 85
    { r: 235, g: 0, b: 55 },    // 86
    { r: 235, g: 0, b: 67 },    // 87
    { r: 235, g: 0, b: 79 },    // 88
    { r: 235, g: 0, b: 91 },    // 89
    { r: 235, g: 0, b: 103 },   // 90
    { r: 235, g: 0, b: 115 },   // 91
    { r: 235, g: 0, b: 127 },   // 92
    { r: 235, g: 0, b: 139 },   // 93
    { r: 235, g: 0, b: 151 },   // 94
    { r: 235, g: 0, b: 163 },   // 95
    { r: 235, g: 0, b: 175 },   // 96
    { r: 235, g: 0, b: 187 },   // 97
    { r: 235, g: 0, b: 199 },   // 98
    { r: 235, g: 0, b: 211 },   // 99
    { r: 235, g: 0, b: 223 },   // 100
    { r: 235, g: 0, b: 235 },   // 101 - Magenta
    { r: 223, g: 0, b: 235 },   // 102
    { r: 211, g: 0, b: 235 },   // 103
    { r: 199, g: 0, b: 235 },   // 104
    { r: 187, g: 0, b: 235 },   // 105
    { r: 175, g: 0, b: 235 },   // 106
    { r: 163, g: 0, b: 235 },   // 107
    { r: 151, g: 0, b: 235 },   // 108
    { r: 139, g: 0, b: 235 },   // 109
    { r: 127, g: 0, b: 235 },   // 110
    { r: 115, g: 0, b: 235 },   // 111
    { r: 103, g: 0, b: 235 },   // 112
    { r: 91, g: 0, b: 235 },    // 113
    { r: 79, g: 0, b: 235 },    // 114
    { r: 67, g: 0, b: 235 },    // 115
    { r: 55, g: 0, b: 235 },    // 116
    { r: 43, g: 0, b: 235 },    // 117
    { r: 31, g: 0, b: 235 },    // 118
    { r: 19, g: 0, b: 235 },    // 119
    { r: 7, g: 0, b: 235 },     // 120
    { r: 0, g: 0, b: 235 },     // 121 - Blue
    { r: 0, g: 7, b: 235 },     // 122
    { r: 0, g: 19, b: 235 },    // 123
    { r: 0, g: 31, b: 235 },    // 124
    { r: 0, g: 43, b: 235 },    // 125
    { r: 0, g: 55, b: 235 },    // 126
    { r: 0, g: 67, b: 235 },    // 127
    { r: 0, g: 79, b: 235 },    // 128
    { r: 0, g: 91, b: 235 },    // 129
    { r: 0, g: 103, b: 235 },   // 130
    { r: 0, g: 115, b: 235 },   // 131
    { r: 0, g: 127, b: 235 },   // 132
    { r: 0, g: 139, b: 235 },   // 133
    { r: 0, g: 151, b: 235 },   // 134
    { r: 0, g: 163, b: 235 },   // 135
    { r: 0, g: 175, b: 235 },   // 136
    { r: 0, g: 187, b: 235 },   // 137
    { r: 0, g: 199, b: 235 },   // 138
    { r: 0, g: 211, b: 235 },   // 139
    { r: 0, g: 223, b: 235 },   // 140
    { r: 0, g: 235, b: 235 },   // 141 - Cyan
    { r: 0, g: 235, b: 223 },   // 142
    { r: 0, g: 235, b: 211 },   // 143
    { r: 0, g: 235, b: 199 },   // 144
    { r: 0, g: 235, b: 187 },   // 145
    { r: 0, g: 235, b: 175 },   // 146
    { r: 0, g: 235, b: 163 },   // 147
    { r: 0, g: 235, b: 151 },   // 148
    { r: 0, g: 235, b: 139 },   // 149
    { r: 0, g: 235, b: 127 },   // 150
    { r: 0, g: 235, b: 115 },   // 151
    { r: 0, g: 235, b: 103 },   // 152
    { r: 0, g: 235, b: 91 },    // 153
    { r: 0, g: 235, b: 79 },    // 154
    { r: 0, g: 235, b: 67 },    // 155
    { r: 0, g: 235, b: 55 },    // 156
    { r: 0, g: 235, b: 43 },    // 157
    { r: 0, g: 235, b: 31 },    // 158
    { r: 0, g: 235, b: 19 },    // 159
    { r: 0, g: 235, b: 7 },     // 160
    { r: 0, g: 235, b: 0 },     // 161 - Green
    { r: 19, g: 235, b: 0 },    // 162
    { r: 31, g: 235, b: 0 },    // 163
    { r: 43, g: 235, b: 0 },    // 164
    { r: 55, g: 235, b: 0 },    // 165
    { r: 67, g: 235, b: 0 },    // 166
    { r: 79, g: 235, b: 0 },    // 167
    { r: 91, g: 235, b: 0 },    // 168
    { r: 103, g: 235, b: 0 },   // 169
    { r: 115, g: 235, b: 0 },   // 170
    { r: 127, g: 235, b: 0 },   // 171
    { r: 139, g: 235, b: 0 },   // 172
    { r: 151, g: 235, b: 0 },   // 173
    { r: 163, g: 235, b: 0 },   // 174
    { r: 175, g: 235, b: 0 },   // 175
    { r: 187, g: 235, b: 0 },   // 176
    { r: 199, g: 235, b: 0 },   // 177
    { r: 211, g: 235, b: 0 },   // 178
    { r: 223, g: 235, b: 0 },   // 179
    { r: 235, g: 235, b: 0 },   // 180 - Yellow
    { r: 235, g: 231, b: 0 },   // 181
    { r: 235, g: 227, b: 0 },   // 182
    { r: 235, g: 223, b: 0 },   // 183
    { r: 235, g: 219, b: 0 },   // 184
    { r: 235, g: 215, b: 0 },   // 185
    { r: 235, g: 211, b: 0 },   // 186
    { r: 235, g: 207, b: 0 },   // 187
    { r: 235, g: 203, b: 0 },   // 188
    { r: 235, g: 199, b: 0 },   // 189
    { r: 235, g: 195, b: 0 },   // 190
    { r: 235, g: 191, b: 0 },   // 191
    { r: 235, g: 187, b: 0 },   // 192
    { r: 235, g: 183, b: 0 },   // 193
    { r: 235, g: 179, b: 0 },   // 194
    { r: 235, g: 175, b: 0 },   // 195
    { r: 235, g: 171, b: 0 },   // 196
    { r: 235, g: 167, b: 0 },   // 197
    { r: 235, g: 163, b: 0 },   // 198
    { r: 235, g: 159, b: 0 },   // 199
    { r: 235, g: 155, b: 0 },   // 200
    { r: 235, g: 151, b: 0 },   // 201
    { r: 235, g: 147, b: 0 },   // 202
    { r: 235, g: 143, b: 0 },   // 203
    { r: 235, g: 139, b: 0 },   // 204
    { r: 235, g: 135, b: 0 },   // 205
    { r: 235, g: 131, b: 0 },   // 206
    { r: 235, g: 127, b: 0 },   // 207
    { r: 235, g: 123, b: 0 },   // 208
    { r: 235, g: 119, b: 0 },   // 209
    { r: 235, g: 115, b: 0 },   // 210
    { r: 235, g: 111, b: 0 },   // 211
    { r: 235, g: 107, b: 0 },   // 212
    { r: 235, g: 103, b: 0 },   // 213
    { r: 235, g: 99, b: 0 },    // 214
    { r: 235, g: 95, b: 0 },    // 215
    { r: 235, g: 91, b: 0 },    // 216
    { r: 235, g: 87, b: 0 },    // 217
    { r: 235, g: 83, b: 0 },    // 218
    { r: 235, g: 79, b: 0 },    // 219
    { r: 235, g: 75, b: 0 },    // 220
    { r: 235, g: 71, b: 0 },    // 221
    { r: 235, g: 67, b: 0 },    // 222
    { r: 235, g: 63, b: 0 },    // 223
    { r: 235, g: 59, b: 0 },    // 224
    { r: 235, g: 55, b: 0 },    // 225
    { r: 235, g: 51, b: 0 },    // 226
    { r: 235, g: 47, b: 0 },    // 227
    { r: 235, g: 43, b: 0 },    // 228
    { r: 235, g: 39, b: 0 },    // 229
    { r: 235, g: 35, b: 0 },    // 230
    { r: 235, g: 31, b: 0 },    // 231
    { r: 235, g: 27, b: 0 },    // 232
    { r: 235, g: 23, b: 0 },    // 233
    { r: 235, g: 19, b: 0 },    // 234
    { r: 235, g: 15, b: 0 },    // 235
    { r: 235, g: 11, b: 0 },    // 236
    { r: 235, g: 7, b: 0 },     // 237
    { r: 235, g: 3, b: 0 },     // 238
    { r: 235, g: 0, b: 0 },     // 239 - Red
    { r: 239, g: 0, b: 0 },     // 240
    { r: 243, g: 0, b: 0 },     // 241
    { r: 247, g: 0, b: 0 },     // 242
    { r: 251, g: 0, b: 0 },     // 243
    { r: 255, g: 0, b: 0 },     // 244 - Bright Red
    { r: 255, g: 3, b: 0 },     // 245
    { r: 255, g: 7, b: 0 },     // 246
    { r: 255, g: 11, b: 0 },    // 247
    { r: 255, g: 15, b: 0 },    // 248
    { r: 255, g: 19, b: 0 },    // 249
    { r: 255, g: 23, b: 0 },    // 250
    { r: 255, g: 27, b: 0 },    // 251
    { r: 255, g: 31, b: 0 },    // 252
    { r: 255, g: 35, b: 0 },    // 253
    { r: 255, g: 39, b: 0 },    // 254
    { r: 255, g: 255, b: 255 }  // 255 - White (near)
];

/**
 * Get the chromadepth color for a given depth value (0-255)
 * Black (0) = far, White (255) = near
 */
function getChromadepthColor(depthValue) {
    const index = Math.min(255, Math.max(0, Math.round(depthValue)));
    return CHROMADEPTH_PALETTE[index];
}

/**
 * Convert a grayscale depth map to chromadepth colors
 * @param {ImageData} depthImageData - Grayscale depth map
 * @returns {ImageData} Chromadepth colored image
 */
function convertDepthToChromadepth(depthImageData) {
    const data = depthImageData.data;
    const chromadepthData = new Uint8ClampedArray(data.length);

    for (let i = 0; i < data.length; i += 4) {
        // Use the grayscale value (all channels should be the same)
        const depthValue = data[i]; // Red channel

        const color = getChromadepthColor(depthValue);
        chromadepthData[i] = color.r;
        chromadepthData[i + 1] = color.g;
        chromadepthData[i + 2] = color.b;
        chromadepthData[i + 3] = data[i + 3]; // Preserve alpha
    }

    return new ImageData(chromadepthData, depthImageData.width, depthImageData.height);
}
